---
title: MDX ランタイムヘルパー
description: ランタイムヘルパーと hydration の挙動。
weight: 2
starryNight: true
---

# MDX ランタイムヘルパー

Methanol は各 MDX に小さなランタイムコンテキストを注入し、テンプレートや動的な表示を作りやすくします。

## コンテキスト値

以下は常に利用できます。

- `ctx`: ページとサイトのコンテキスト
- `frontmatter`: `ctx.page.frontmatter` のショートハンド
- `rawHTML`: エスケープしない HTML を差し込むための入口

```mdx
# {frontmatter.title ?? ctx.page.title}

現在のルート: {ctx.routePath}
```

## コンテキストの形

`ctx` の主なフィールド:

- `ctx.page`: 現在のページメタデータ（詳細は下記）
- `ctx.pages`: 全ページの一覧（非表示や index も含む）
- `ctx.pagesTree`: 現在のルートに対するナビゲーションツリー
- `ctx.site`: サイト情報（`name`, `root`, `pagesDir`, `distDir`, `pagefind` など）
- `ctx.withBase(path)`: `/` で始まる URL に `site.base`/Vite base を付与（相対 URL はそのまま）
- `ctx.language`: アクティブな言語エントリ（`lang` を持つディレクトリ index がある場合。`label` と `code` を含む）
- `ctx.getSiblings()`: 現在のページの `{ prev, next }` を返す

注意: `theme.sources` の URL や `public/` 配下の静的ファイルは、通常 `ctx.withBase()` を付ける必要はありません（Methanol がビルド時に解決します）。ただし JS 生成 URL で Vite dev の解決が不安定な場合、`ctx.withBase('/...')` が回避策として役立つことがあります。

### ctx.page

`ctx.page` は現在のページのメタデータです。主なフィールド:

- `routePath`: 正規化されたルート（例: `/guide/writing`）
- `routeHref`: リンク用の base 対応 href（`site.base` / Vite base を含む）

補足: ディレクトリ index のルートは `routePath` 末尾に `/` が付きます（例: `/guide/`）。
- `filePath`: ソースファイルの絶対パス
- `title`: 解決済みのタイトル（frontmatter か見出し由来）
- `frontmatter`: パース済みの YAML frontmatter
- `toc`: 抽出された目次
- `isIndex`: `index.mdx` のとき `true`
- `dir`: `pagesDir` からの相対ディレクトリ
- `segments`: ルートのセグメント配列
- `hidden`: ナビゲーションで非表示かどうか
- `isRoot`: ナビゲーションルートを示すかどうか
- `date`: frontmatter の日付がある場合の ISO 文字列
- `updatedAt`: 最終更新タイムスタンプ（取得できる場合）

例:

```mdx
{ctx.page.title}
{ctx.page.frontmatter?.excerpt}
```

### ctx.pages

`ctx.pages` は全ページの一覧（`ctx.page` と同じ形）です。index と非表示ページも含みますが、`exclude: true` のページは含みません。

独自の一覧やサイトマップ、手動ナビゲーションに使えます。

```jsx
<ul>
  {ctx.pages.map((page) => (
    <li><a href={page.routeHref || page.routePath}>{page.title}</a></li>
  ))}
</ul>
```

### ctx.pagesTree

`ctx.pagesTree` は現在のルートに対する階層ツリーです（`isRoot` と `hidden` のルールを反映）。ノードの形:

- `type`: `"page"` または `"directory"`
- `title` / `name`: 表示用ラベル
- `routePath` / `routeHref`: ルート
- `children`: ディレクトリの子ノード

サイドバーと同じ構造の UI を作るのに使えます。

```jsx
{ctx.pagesTree.map((node) => (
  <div>{node.title || node.name}</div>
))}
```

### ctx.getSiblings

`ctx.getSiblings()` は現在のナビゲーション順における前後ページを返します。現在のルートと非表示/除外ルールを尊重し、サイドバーと同じ順序になります。

```jsx
{(() => {
  const siblings = ctx.getSiblings.()
  if (!siblings) return null
  return (
    <nav>
      {siblings.prev ? <a href={siblings.prev.routeHref || siblings.prev.routePath}>前へ: {siblings.prev.title}</a> : null}
      {siblings.next ? <a href={siblings.next.routeHref || siblings.next.routePath}>次へ: {siblings.next.title}</a> : null}
    </nav>
  )
})()}
```

## rawHTML

`rawHTML` はエスケープしない HTML を挿入します。インラインスクリプトや、エスケープされたくないマークアップに使えます。

```jsx
{rawHTML('<span class="badge">Beta</span>')}
{rawHTML`<div data-banner="true">Banner</div>`}
```

`rawHTML` はシグナルやテンプレート補間も受け取れます。
